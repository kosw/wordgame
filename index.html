<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Word Game</title>
  <script>
    var failCnt = 0;
    var successCnt = 0;
    var speed = 2000;
    var wordlist = ["banana","coffee","friends","sun","star","apple",
    "meat","strawberry","weather","mike","juice","desktop",
    "piano","guitar","donus","org","game","tokyo","america","christmas",
    "spring","winter","summer","fall","france"];

    function startGame(){
      var rn = randomNumber(wordlist.length);
      var words = wordlist[rn];
      insertWords(words);
      moveWords();
      setTimeout(startGame,speed);
    }
    // function endGame(){
      
    // }
    function stopGame(){
      location.reload();
      alert("점수 : "+successCnt+"점 입니다.");
    }
    function downWords(){ //단어 떨어지게하는 함수
      len = document.getElementsByTagName("span").length;
      for(var i=1;i<len;i++){
          //현재의 paddingtop값에 20추가.
          var curr = document.getElementsByTagName("span")[i].style.paddingTop;
          if(curr === "") {
            curr = "0";
          }
          var next = parseInt(curr)+30;
          if(next >=381){ //height over했을때 삭제
            failCnt++;
            document.getElementsByTagName("span")[i].innerHTML = "";
            document.getElementById("screen").removeChild(document.getElementsByTagName("span")[i]);
            //console.log("실패 : "+failCnt.toString()+"/20"+" "+len);
            document.getElementById("fail").innerHTML = "실패 : "+failCnt.toString()+" / 20";
          } 
          if(document.getElementsByTagName("span")[i]){ //삭제되지 않은 노드에 한해서 조정
            document.getElementsByTagName("span")[i].style.paddingTop = next.toString()+"px";
          }
        }
        if(failCnt == 21){
          stopGame();
        }
      }
    function moveWords(){ //단어 좌우로 이동하게 하는 함수
      var len = document.getElementsByTagName("span").length;
      for(var i=1;i<len;i++){
        var left = randomNumber(400).toString() +"px";
        document.getElementsByTagName("span")[i].style.paddingLeft = left;
      }
    }

    function insertWords(words){ //노드 생성하고 #screen에 첫번째 자식으로 삽입
      var pos = document.getElementById("screen");
      var node = createNode(words);
      if(pos.children[0]){ //isChildren
        document.getElementById("screen").insertBefore(node, document.getElementById("screen").children[0]);
      } else{
        document.getElementById("screen").appendChild(node);
      }
    }
    function createNode(words){ //단어를 담을 span 태그 노드 생성
      downWords();
      var node = document.createElement("span");
      node.innerHTML = words;
      return node;
    }
    function randomNumber(p){ //최대 p 보다 작은 난수 생성
      var rn = Math.floor(Math.random()*p);
      return rn;
    }
    function compare(){ //screen 상에 뿌려지는 단어들과 비교하고 삭제
      var input = document.getElementById("wordInput").value;
      var len = document.getElementsByTagName("span").length;
      for(var i=len-1; i>=1;i--){
        //console.log(document.getElementsByTagName("span")[i].innerHTML);
        if(document.getElementsByTagName("span")[i].innerHTML == input){
          successCnt++;
          document.getElementsByTagName("span")[i].innerHTML = "";
          document.getElementById("screen").removeChild(document.getElementsByTagName("span")[i]);
          document.getElementById("success").innerHTML = "성공 : "+successCnt.toString();
          break;
        }
      }
      funfun();
      document.getElementById("wordInput").value = "";
    }
    function funfun(){
      var rn = randomNumber(100);
      var len = document.getElementsByTagName("span").length;
      console.log(rn);
      if(rn > 30 && rn <= 50){ // 잘 안보임
        for(var i=1; i<len; i++){
          if(document.getElementsByTagName("span")[i]){
            document.getElementsByTagName("span")[i].style.color = "yellow";
          }
        }
      }else{ 
        for(var i=1; i<len; i++){
          if(document.getElementsByTagName("span")[i]){
            document.getElementsByTagName("span")[i].style.color = "black";
          }
        }
        if(rn > 20 && rn <= 30){ //속도 2배
          speed = 1000;
          document.getElementById("level").innerHTML = "Level : Normal"
        } 
        else if(rn > 10 && rn <= 20){ //속도 4배
          speed = 500;
          document.getElementById("level").innerHTML = "Level : Hard"
        }
        else if(rn > 70 && rn <= 74){
          document.getElementById("cc").src = "coffee.png";
        }
      }
    }
  </script>
  <style>
  #game {
    border:1px solid gray;
    width:500px;
    height:25px;
  }
  #screen {
    border:1px solid gray;
    border-top:20px solid pink;
    position:relative;
    width:500px;
    height:400px; 
    
  }
  #screen span{
    position:absolute;
  }
/*#command {
   border:1px solid gray;
   border-top:20px solid pink;
   width:500px;
   height:150px;
   }*/
   #grid {
    border:1px solid gray;
    border-top:20px solid pink;
    width:500px;
    height:150px;
    display:grid;
    grid-template-columns: 1fr 1fr;
  }
  #command {
    border-right:1px solid gray;
    width:250px;
  }
</style>
</head>
<body>
  <div id="game">
    <span id="wordGame" style="padding-left:170px">Word Game
      <input type="button" value="START!" onclick="startGame()">
      <input type="button" value="STOP!" onclick=" stopGame()">
    </span>
  </div>
  <div id="screen">
  </div>
  <div id="grid">
    <div id="command"> 
      <Input type="text" id="wordInput" onchange="compare()">
      <div id="success">성공 : 0</div>
      <div id="fail"> 실패 : 0 / 20 </div>
      <div id="level"> Level : Easy </div>
    </div>
    <div id="coupon">
      <img id="cc"></img>
    </div>
  </div>
</body>
</html>